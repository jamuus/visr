<html>

<head>
    <style type="text/css">
        
        #log {
            position: fixed;
            width: 20%;
            height: 100%;
            right: 0;
            top: 0;
        }
        #container {
            position: fixed;
            width: 80%;
        }
    </style>
</head>

<body onload="init()">
<div id="container">
    <canvas id="chart1" width="600" height="400"></canvas>
    <canvas id="chart2" width="600" height="400"></canvas>
    <canvas id="chart3" width="600" height="400"></canvas>
    <canvas id="chart4" width="600" height="400"></canvas>
</div>
    <textarea id="log"></textarea>
    <script src="/socket.io/socket.io.js"></script>
    <script type="text/javascript" src="smoothie.js"></script>
    <script type="text/javascript">

    var socket = io();

    var ts1 = new TimeSeries();
    var ts2 = new TimeSeries();
    var ts3 = new TimeSeries();
    var ts4 = new TimeSeries();

    var log = document.querySelector('#log');

    socket.on('data', parseLine);

    var state = {};

    var var2ts = {a: ts1,b: ts2,c: ts3,d: ts4};

    function parseLine(line) {
        line = line.split(':');
        var variable = line[0].trim();
        var value = parseFloat(line[1].trim());
        state[variable] = value;
        log.value = JSON.stringify(state, null, '    ');

        var2ts[variable].append(new Date().getTime(), value);
    }

    function init() {
        createTimeline('chart1', ts1);
        createTimeline('chart2', ts2);
        createTimeline('chart3', ts3);
        createTimeline('chart4', ts4);
    }

    function createTimeline(id, ts) {
        var chart = new SmoothieChart({millisPerPixel: 10});
        chart.addTimeSeries(ts, {
            strokeStyle: 'rgba(255, 0, 0, 1)',
            lineWidth: 2
        });
        chart.streamTo(document.getElementById(id), 500);
    }
    </script>
</body>

</html>
